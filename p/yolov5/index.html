<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="YOLOv5 简介 Yolov5是一种快速、准确的目标检测算法，它将目标检测任务看作一个回归问题。在输入图像的情况下，YOLOv5使用卷积神经网络直接预测图像中的目标的边界框和类别信息。
YOLOv5具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。与此同时，YOLOv5也具有很高的可定制性，可以通过在不同数据集和应用需求下进行修改和扩展，以达到更好的性能。
网络结构 YOLOv5的网络结构可以分为两个部分，即主干网络和检测头。
主干网络采用CSPNet（Cross Stage Partial Network）结构，主要由一系列CSP块组成。每个CSP块包含多个卷积层和残差连接。具体来说，每个CSP块首先将输入特征图分成两个路径，一条路径进行卷积计算，另一条路径直接输出。两个路径的特征图在最后通过残差连接进行合并。这种结构可以加快特征提取速度，同时提高准确性。
检测头由多个卷积层和全连接层组成，其输出包括目标的坐标和类别信息。YOLOv5将检测头输出的特征图划分为网格，每个网格预测若干个目标，每个目标由包含目标中心点的网格、目标边界框偏移量、目标得分和目标类别组成。此外，YOLOv5还引入了自注意力机制，以进一步提高检测准确性。自注意力机制允许网络自动关注输入中的相关区域，从而增强目标检测的能力。
总体来说，YOLOv5的网络结构相对简单，但它在卷积神经网络、残差连接和注意力机制方面进行了优化，使得其具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。
代码组成 YOLOv5的代码主要由以下几个部分组成：
1.models文件夹：包含YOLOv5模型的主干网络和检测头的定义，其中主干网络定义在csp.py中，检测头定义在yolo.py中。
2.utils文件夹：包含与YOLOv5相关的各种工具函数和工具类，如数据加载器、预处理器、数据增强器、NMS处理、锚框计算等等。
3.train.py：训练YOLOv5模型的代码，包括定义训练流程、设置超参数、加载数据集、构建模型、优化器、损失函数等等。
4.detect.py：对图像或视频进行目标检测的代码，可以将预测结果保存到指定的输出文件中。
5.test.py：对测试集进行目标检测的代码，用于评估模型的性能。
6.hubconf.py：用于实现模型的导出和使用，方便其他开发者和应用程序调用YOLOv5模型。
7.requirements.txt：列出YOLOv5所依赖的Python库和版本，方便用户安装和使用。
YOLOv5的代码采用了PyTorch框架，易于使用GPU加速，可以大大提高训练和推理速度。
Yolov5剪枝 YOLOv5可以使用剪枝技术来减小模型的尺寸，以减少计算量和内存占用，提高模型的推理速度。下面以YOLOv5s为例，介绍如何对网络结构进行剪枝。
首先，我们需要安装pytorch-pruning库，该库提供了对PyTorch模型进行剪枝的工具。在安装好pytorch-pruning库之后，我们需要在YOLOv5s模型中添加一个剪枝层，用于剪枝CSP网络和检测头中的卷积层。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import torch.nn as nn import torch.nn.utils.prune as prune class PruningModule(nn.Module): def __init__(self, module): super(PruningModule, self).__init__() self.module = module def forward(self, x): return self.module(x) def apply_pruning(module): PruningModule(module) for name, child in module."><title>Yolov5</title><link rel=canonical href=https://cv-cver.github.io/p/yolov5/><link rel=stylesheet href=/scss/style.min.5be32ca3f6e1a997c75795c4359147cc6d4fbd34948c0acd51e31d237033978a.css><meta property="og:title" content="Yolov5"><meta property="og:description" content="YOLOv5 简介 Yolov5是一种快速、准确的目标检测算法，它将目标检测任务看作一个回归问题。在输入图像的情况下，YOLOv5使用卷积神经网络直接预测图像中的目标的边界框和类别信息。
YOLOv5具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。与此同时，YOLOv5也具有很高的可定制性，可以通过在不同数据集和应用需求下进行修改和扩展，以达到更好的性能。
网络结构 YOLOv5的网络结构可以分为两个部分，即主干网络和检测头。
主干网络采用CSPNet（Cross Stage Partial Network）结构，主要由一系列CSP块组成。每个CSP块包含多个卷积层和残差连接。具体来说，每个CSP块首先将输入特征图分成两个路径，一条路径进行卷积计算，另一条路径直接输出。两个路径的特征图在最后通过残差连接进行合并。这种结构可以加快特征提取速度，同时提高准确性。
检测头由多个卷积层和全连接层组成，其输出包括目标的坐标和类别信息。YOLOv5将检测头输出的特征图划分为网格，每个网格预测若干个目标，每个目标由包含目标中心点的网格、目标边界框偏移量、目标得分和目标类别组成。此外，YOLOv5还引入了自注意力机制，以进一步提高检测准确性。自注意力机制允许网络自动关注输入中的相关区域，从而增强目标检测的能力。
总体来说，YOLOv5的网络结构相对简单，但它在卷积神经网络、残差连接和注意力机制方面进行了优化，使得其具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。
代码组成 YOLOv5的代码主要由以下几个部分组成：
1.models文件夹：包含YOLOv5模型的主干网络和检测头的定义，其中主干网络定义在csp.py中，检测头定义在yolo.py中。
2.utils文件夹：包含与YOLOv5相关的各种工具函数和工具类，如数据加载器、预处理器、数据增强器、NMS处理、锚框计算等等。
3.train.py：训练YOLOv5模型的代码，包括定义训练流程、设置超参数、加载数据集、构建模型、优化器、损失函数等等。
4.detect.py：对图像或视频进行目标检测的代码，可以将预测结果保存到指定的输出文件中。
5.test.py：对测试集进行目标检测的代码，用于评估模型的性能。
6.hubconf.py：用于实现模型的导出和使用，方便其他开发者和应用程序调用YOLOv5模型。
7.requirements.txt：列出YOLOv5所依赖的Python库和版本，方便用户安装和使用。
YOLOv5的代码采用了PyTorch框架，易于使用GPU加速，可以大大提高训练和推理速度。
Yolov5剪枝 YOLOv5可以使用剪枝技术来减小模型的尺寸，以减少计算量和内存占用，提高模型的推理速度。下面以YOLOv5s为例，介绍如何对网络结构进行剪枝。
首先，我们需要安装pytorch-pruning库，该库提供了对PyTorch模型进行剪枝的工具。在安装好pytorch-pruning库之后，我们需要在YOLOv5s模型中添加一个剪枝层，用于剪枝CSP网络和检测头中的卷积层。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import torch.nn as nn import torch.nn.utils.prune as prune class PruningModule(nn.Module): def __init__(self, module): super(PruningModule, self).__init__() self.module = module def forward(self, x): return self.module(x) def apply_pruning(module): PruningModule(module) for name, child in module."><meta property="og:url" content="https://cv-cver.github.io/p/yolov5/"><meta property="og:site_name" content="剑庐"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:published_time" content="2023-03-24T23:22:04+08:00"><meta property="article:modified_time" content="2023-03-24T23:22:04+08:00"><meta property="og:image" content="https://cv-cver.github.io/img/3.jpg"><meta name=twitter:title content="Yolov5"><meta name=twitter:description content="YOLOv5 简介 Yolov5是一种快速、准确的目标检测算法，它将目标检测任务看作一个回归问题。在输入图像的情况下，YOLOv5使用卷积神经网络直接预测图像中的目标的边界框和类别信息。
YOLOv5具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。与此同时，YOLOv5也具有很高的可定制性，可以通过在不同数据集和应用需求下进行修改和扩展，以达到更好的性能。
网络结构 YOLOv5的网络结构可以分为两个部分，即主干网络和检测头。
主干网络采用CSPNet（Cross Stage Partial Network）结构，主要由一系列CSP块组成。每个CSP块包含多个卷积层和残差连接。具体来说，每个CSP块首先将输入特征图分成两个路径，一条路径进行卷积计算，另一条路径直接输出。两个路径的特征图在最后通过残差连接进行合并。这种结构可以加快特征提取速度，同时提高准确性。
检测头由多个卷积层和全连接层组成，其输出包括目标的坐标和类别信息。YOLOv5将检测头输出的特征图划分为网格，每个网格预测若干个目标，每个目标由包含目标中心点的网格、目标边界框偏移量、目标得分和目标类别组成。此外，YOLOv5还引入了自注意力机制，以进一步提高检测准确性。自注意力机制允许网络自动关注输入中的相关区域，从而增强目标检测的能力。
总体来说，YOLOv5的网络结构相对简单，但它在卷积神经网络、残差连接和注意力机制方面进行了优化，使得其具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。
代码组成 YOLOv5的代码主要由以下几个部分组成：
1.models文件夹：包含YOLOv5模型的主干网络和检测头的定义，其中主干网络定义在csp.py中，检测头定义在yolo.py中。
2.utils文件夹：包含与YOLOv5相关的各种工具函数和工具类，如数据加载器、预处理器、数据增强器、NMS处理、锚框计算等等。
3.train.py：训练YOLOv5模型的代码，包括定义训练流程、设置超参数、加载数据集、构建模型、优化器、损失函数等等。
4.detect.py：对图像或视频进行目标检测的代码，可以将预测结果保存到指定的输出文件中。
5.test.py：对测试集进行目标检测的代码，用于评估模型的性能。
6.hubconf.py：用于实现模型的导出和使用，方便其他开发者和应用程序调用YOLOv5模型。
7.requirements.txt：列出YOLOv5所依赖的Python库和版本，方便用户安装和使用。
YOLOv5的代码采用了PyTorch框架，易于使用GPU加速，可以大大提高训练和推理速度。
Yolov5剪枝 YOLOv5可以使用剪枝技术来减小模型的尺寸，以减少计算量和内存占用，提高模型的推理速度。下面以YOLOv5s为例，介绍如何对网络结构进行剪枝。
首先，我们需要安装pytorch-pruning库，该库提供了对PyTorch模型进行剪枝的工具。在安装好pytorch-pruning库之后，我们需要在YOLOv5s模型中添加一个剪枝层，用于剪枝CSP网络和检测头中的卷积层。
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 import torch.nn as nn import torch.nn.utils.prune as prune class PruningModule(nn.Module): def __init__(self, module): super(PruningModule, self).__init__() self.module = module def forward(self, x): return self.module(x) def apply_pruning(module): PruningModule(module) for name, child in module."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://cv-cver.github.io/img/3.jpg"><link rel="shortcut icon" href=img/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/man_hu5f54adb73a2066d7192d7955df42ac6a_30214_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>😄</span></figure><div class=site-meta><h1 class=site-name><a href=/>剑庐</a></h1><h2 class=site-description>欢迎少侠</h2></div></header><ol class=social-menu><li><a href=https://github.com/cv-cver target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href target=_blank title=QQ rel=me><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32"><path d="M16 5.886719c6.085938.0 6.394531 5.4375 6.730469 6.507812.0.0.480468999999999.535157.59375 1.351563C23.398438 14.273438 23.097656 14.871094 23.097656 14.871094s1.945313 2.621094 1.945313 4.679687C25.042969 20.835938 24.664063 21.5 24.222656 21.5c-.445312000000001.0-1.09375-1.359375-1.09375-1.359375s-1.015625 2.167969-1.523437 2.480469C21.097656 22.929688 23.4375 23.269531 23.4375 24.28125c0 1.015625-1.859375 1.464844-3.378906 1.464844C18.535156 25.746094 16.113281 24.957031 16.113281 24.957031L15.238281 24.929688S14.5625 25.886719 11.773438 25.886719c-2.789063.0-4-.757812999999999-4-1.660156.0-1.214844 1.777343-1.378907 1.777343-1.378907S8.417969 22.53125 7.460938 19.851563c0 0-.664063 1.445312-1.601563 1.445312.0.0-.394531-.234375-.394531-1.550781.0-2.722656 1.957031-4.050781 2.800781-4.867188.0.0-.140625-.355468-.0664060000000006-.796875C8.28125 13.589844 8.574219 13.292969 8.574219 13.292969S8.464844 12.703125 8.875 12.226563C8.957031 10.902344 9.914063 5.886719 16 5.886719m0-2c-6.398437.0-8.667969 4.589844-9.070312 7.667969-.191407.375-.300782.761718-.34375 1.125C6.433594 12.96875 6.296875 13.324219 6.226563 13.746094 6.207031 13.851563 6.195313 13.960938 6.1875 14.0625c-1.109375 1.019531-2.722656 2.757813-2.722656 5.683594.0 2.03125.746094 2.898437 1.375 3.269531l.46875.28125h.550781c.015625.0.03125.0.0507809999999997.0C5.820313 23.582031 5.773438 23.890625 5.773438 24.226563c0 .859375.433593 3.664062 6 3.664062C13.8125 27.890625 15.085938 27.449219 15.867188 26.976563 16.6875 27.222656 18.605469 27.746094 20.054688 27.746094c3.269531.0 5.382812-1.359375 5.382812-3.464844C25.4375 23.90625 25.363281 23.574219 25.242188 23.277344c.964843000000002-.4375 1.796875-1.566406 1.796875-3.726563.0-1.894531-1.046875-3.882812-1.757813-5.015625C25.335938 14.210938 25.355469 13.847656 25.304688 13.472656 25.1875 12.632813 24.851563 11.964844 24.582031 11.546875 24.574219 11.507813 24.566406 11.46875 24.558594 11.429688 23.511719 6.421875 20.628906 3.886719 16 3.886719z"/></svg></a></li><li><a href='http://m.weibo.cn/u/6613547170?uid=6613547170&amp;t=userinfo&_T_WM=8eb0ef35a7dcf0296b9914caf916c741' target=_blank title=Weibo rel=me><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" width="48" height="48"><path d="M33.394531 4.0058594A1.50015 1.50015.0 0033.419922 7.0039062c5.19533.2143304 9.350764 4.3663078 9.570312 9.5605468a1.5003674 1.5003674.0 002.998047-.126953C45.70383 9.7077388 40.273639 4.2854823 33.542969 4.0078125A1.50015 1.50015.0 0033.394531 4.0058594zM33.5 9.4960938a1.50015 1.50015.0 100 3.0000002c2.227598.0 4 1.772401 4 4a1.50015 1.50015.0 103 0c0-3.848402-3.151598-7.0000003-7-7.0000002zm-14.041016.5C12.269984 9.9960938 2 22.371094 2 30.621094c0 7.219 6.1612969 12.375 15.404297 12.375C17.535007 42.996094 17.65965 42.989449 17.789062 42.988281 17.860497 42.988878 17.928182 42.996094 18 42.996094 18.23083 42.996094 18.458061 42.979211 18.6875 42.972656 18.824056 42.968506 18.960645 42.964444 19.095703 42.958984 19.347128 42.94756 19.59843 42.937061 19.847656 42.917969 34.447711 42.047859 40 33.450024 40 28.558594c0-3.761-3.278734-4.777735-5.052734-5.052735C34.385266 23.418859 34.026875 22.8655 34.171875 22.3125 34.761875 20.0705 35.521672 15.001953 30.763672 15.001953c-3.045.0-5.373766 1.239-6.759766 2.125C23.921906 17.179953 23.832047 17.201172 23.748047 17.201172 23.461047 17.201172 23.207062 16.931375 23.289062 16.609375 23.447063 15.993375 23.566406 15.178094 23.566406 14.121094 23.567406 9.9960937 19.458984 9.9960937 19.458984 9.9960938zM19.423828 12.996094C20.567828 13.051094 20.568359 13.644094 20.568359 14.121094 20.568359 14.969094 20.468766 15.537234 20.384766 15.865234 20.116766 16.913234 20.341906 18.002516 21.003906 18.853516 21.658906 19.696516 22.685 20.201172 23.75 20.201172 24.412 20.201172 25.058141 20.011344 25.619141 19.652344c1.741-1.112 3.424484-1.650391 5.146484-1.650391C31.232625 18.001953 31.406063 18.087891 31.414062 18.087891 31.617062 18.336891 31.782484 19.604828 31.271484 21.548828 30.985484 22.633828 31.173109 23.792516 31.787109 24.728516 32.399109 25.662516 33.383281 26.29775 34.488281 26.46875 36.999281 26.85975 37 28.006594 37 28.558594c0 1.445652-.822889000000004 3.584984-2.744141 5.625C34.403023 33.632822 34.5 33.072059 34.5 32.496094c0-5.799-7.052-10.5-15.75-10.5-5.324943.0-10.0242774 1.765795-12.875 4.46289 2.4482569-6.418628 9.476909-13.422081 13.548828-13.46289zm-.673828 12c6.792.0 12.75 3.505 12.75 7.5.0 3.202367-5.032449 6.878371-11.789062 7.423828C19.056834 39.959456 18.381943 39.981355 17.683594 39.986328 11.002562 39.887371 6 36.705072 6 32.496094c0-3.995 5.958-7.5 12.75-7.5zM17.861328 27C17.222962 27.019603 16.56675 27.119781 15.914062 27.308594c-3.480999 1.007-5.592796 4.145719-4.716796 7.011718.875 2.866 4.407671 4.374188 7.888672 3.367188 3.48-1.006 5.591796-4.144719 4.716796-7.011719C23.091797 28.347156 20.62758 26.915052 17.861328 27zM19 30c.552.0 1 .448 1 1s-.448 1-1 1-1-.448-1-1 .448-1 1-1zm-3.5 1.996094C16.328 31.996094 17 32.668094 17 33.496094 17 34.324094 16.328 34.996094 15.5 34.996094S14 34.324094 14 33.496094C14 32.668094 14.672 31.996094 15.5 31.996094z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>主页</span></a></li><li><a href=/%E5%85%B3%E4%BA%8E/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>关于</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>时间轴</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>搜索</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg><select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://cv-cver.github.io/ selected>中文</option><option value=https://cv-cver.github.io/en/>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>暗色模式</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#简介>简介</a></li><li><a href=#网络结构>网络结构</a></li><li><a href=#代码组成>代码组成</a></li><li><a href=#yolov5剪枝>Yolov5剪枝</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/yolov5/><img src=/img/3.jpg loading=lazy alt="Featured image of post Yolov5"></a></div><div class=article-details><header class=article-category><a href=/categories/%E7%AE%97%E6%B3%95/>算法</a>
<a href=/categories/yolov5/>Yolov5</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/yolov5/>Yolov5</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Mar 24, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>阅读时长: 2 分钟</time></div></footer></div></header><section class=article-content><h1 id=yolov5>YOLOv5</h1><h2 id=简介>简介</h2><p>Yolov5是一种快速、准确的目标检测算法，它将目标检测任务看作一个<em>回归问题</em>。在输入图像的情况下，YOLOv5使用卷积神经网络直接预测图像中的目标的边界框和类别信息。</p><p>YOLOv5具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。与此同时，YOLOv5也具有很高的可定制性，可以通过在不同数据集和应用需求下进行修改和扩展，以达到更好的性能。</p><h2 id=网络结构>网络结构</h2><p>YOLOv5的网络结构可以分为两个部分，即主干网络和检测头。</p><p>主干网络采用CSPNet（Cross Stage Partial Network）结构，主要由一系列CSP块组成。每个CSP块包含多个卷积层和残差连接。具体来说，每个CSP块首先将输入特征图分成两个路径，一条路径进行卷积计算，另一条路径直接输出。两个路径的特征图在最后通过残差连接进行合并。这种结构可以加快特征提取速度，同时提高准确性。</p><p>检测头由多个卷积层和全连接层组成，其输出包括目标的坐标和类别信息。YOLOv5将检测头输出的特征图划分为网格，每个网格预测若干个目标，每个目标由包含目标中心点的网格、目标边界框偏移量、目标得分和目标类别组成。此外，YOLOv5还引入了自注意力机制，以进一步提高检测准确性。自注意力机制允许网络自动关注输入中的相关区域，从而增强目标检测的能力。</p><p>总体来说，YOLOv5的网络结构相对简单，但它在卷积神经网络、残差连接和注意力机制方面进行了优化，使得其具有很高的检测速度和准确率，并且可以进行实时目标检测。此外，YOLOv5还支持多种检测精度和速度设置，可以根据具体应用场景选择不同的模型结构。</p><h2 id=代码组成>代码组成</h2><p>YOLOv5的代码主要由以下几个部分组成：</p><p>1.models文件夹：包含YOLOv5模型的主干网络和检测头的定义，其中主干网络定义在csp.py中，检测头定义在yolo.py中。</p><p>2.utils文件夹：包含与YOLOv5相关的各种工具函数和工具类，如数据加载器、预处理器、数据增强器、NMS处理、锚框计算等等。</p><p>3.train.py：训练YOLOv5模型的代码，包括定义训练流程、设置超参数、加载数据集、构建模型、优化器、损失函数等等。</p><p>4.detect.py：对图像或视频进行目标检测的代码，可以将预测结果保存到指定的输出文件中。</p><p>5.test.py：对测试集进行目标检测的代码，用于评估模型的性能。</p><p>6.hubconf.py：用于实现模型的导出和使用，方便其他开发者和应用程序调用YOLOv5模型。</p><p>7.requirements.txt：列出YOLOv5所依赖的Python库和版本，方便用户安装和使用。</p><p>YOLOv5的代码采用了PyTorch框架，易于使用GPU加速，可以大大提高训练和推理速度。</p><h2 id=yolov5剪枝>Yolov5剪枝</h2><p>YOLOv5可以使用剪枝技术来减小模型的尺寸，以减少计算量和内存占用，提高模型的推理速度。下面以YOLOv5s为例，介绍如何对网络结构进行剪枝。</p><p>首先，我们需要安装pytorch-pruning库，该库提供了对PyTorch模型进行剪枝的工具。在安装好pytorch-pruning库之后，我们需要在YOLOv5s模型中添加一个剪枝层，用于剪枝CSP网络和检测头中的卷积层。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>    import torch.nn as nn
</span></span><span class=line><span class=cl>    import torch.nn.utils.prune as prune
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    class PruningModule(nn.Module):
</span></span><span class=line><span class=cl>        def __init__(self, module):
</span></span><span class=line><span class=cl>            super(PruningModule, self).__init__()
</span></span><span class=line><span class=cl>            self.module = module
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        def forward(self, x):
</span></span><span class=line><span class=cl>            return self.module(x)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def apply_pruning(module):
</span></span><span class=line><span class=cl>        PruningModule(module)
</span></span><span class=line><span class=cl>        for name, child in module.named_children():
</span></span><span class=line><span class=cl>            apply_pruning(child)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    def prune_model(model):
</span></span><span class=line><span class=cl>        for name, module in model.named_modules():
</span></span><span class=line><span class=cl>            if isinstance(module, nn.Conv2d):
</span></span><span class=line><span class=cl>                prune.l1_unstructured(module, name=&#39;weight&#39;, amount=0.3)
</span></span></code></pre></td></tr></table></div></div><p>在这里，我们定义了一个PruningModule类，该类用于包装我们要剪枝的模块，并定义了apply_pruning函数和prune_model函数，用于遍历模型并对卷积层进行剪枝。</p><p>接下来，我们可以在train.py中进行如下修改，以使用上述剪枝代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>    from models.yolo import Model
</span></span><span class=line><span class=cl>    from utils.general import init_seeds
</span></span><span class=line><span class=cl>    from utils.torch_utils import model_info
</span></span><span class=line><span class=cl>    from utils.datasets import create_dataloader
</span></span><span class=line><span class=cl>    import argparse
</span></span><span class=line><span class=cl>    import torch.nn.utils.prune as prune
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if __name__ == &#39;__main__&#39;:
</span></span><span class=line><span class=cl>        parser = argparse.ArgumentParser()
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--data&#39;, type=str, default=&#39;data/coco.yaml&#39;, help=&#39;dataset.yaml path&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--cfg&#39;, type=str, default=&#39;models/yolov5s.yaml&#39;, help=&#39;model.yaml path&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--weights&#39;, type=str, default=&#39;weights/yolov5s.pt&#39;, help=&#39;initial weights path&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--batch-size&#39;, type=int, default=16, help=&#39;batch size&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--epochs&#39;, type=int, default=300, help=&#39;number of epochs&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--device&#39;, default=&#39;&#39;, help=&#39;cuda device, i.e. 0 or 0,1,2,3 or cpu&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--multi-scale&#39;, action=&#39;store_true&#39;, help=&#39;adjust (67%% - 150%%) img_size every 10 batches&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--img-size&#39;, nargs=&#39;+&#39;, type=int, default=[640, 640], help=&#39;[train, test] img sizes&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--rect&#39;, action=&#39;store_true&#39;, help=&#39;rectangular training&#39;)
</span></span><span class=line><span class=cl>        parser.add_argument(&#39;--resume&#39;, nargs=&#39;?&#39;, const=True, default=False, help=&#39;resume most recent training&#39;)
</span></span><span class=line><span class=cl>        opt = parser.parse_args()
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 定义模型
</span></span><span class=line><span class=cl>        model = Model(opt.cfg).to(opt.device)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 对模型进行剪枝
</span></span><span class=line><span class=cl>        apply_pruning(model)
</span></span><span class=line><span class=cl>        prune_model(model)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        # 输出剪枝后的模型结构信息
</span></span><span class=line><span class=cl>        model_info(model)
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>版权声明：本文为剑庐主人原创，依据 <a class=link href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel=noopener>CC BY-SA 4.0</a> 许可证进行授权，转载请附上出处链接及本声明。</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script><script src=https://cdn.jsdelivr.net/gh/Zevs6/CDN/js/title.js async></script>
<script src=https://cdn.jsdelivr.net/gh/Zevs6/CDN/js/wenzi.js async></script>
<script src=https://cdn.jsdelivr.net/gh/Zevs6/CDN/js/aixintexiao.js async></script>
<script src=https://cdn.jsdelivr.net/gh/acai66/live2d@0.47/xuehua.js async></script></article><div class=disqus-container><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2023 剑庐<br>本站已艰难运行:
<span id=momk></span>
<script language=javascript>function show_time(){window.setTimeout("show_time()",1e3),BirthDay=new Date("2023/03/17 12:12:24"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=24*60*60*1e3,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=(daysold-e_daysold)*-24,hrsold=Math.floor(e_hrsold),e_minsold=(hrsold-e_hrsold)*-60,minsold=Math.floor((hrsold-e_hrsold)*-60),seconds=Math.floor((minsold-e_minsold)*-60),momk.innerHTML=daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}show_time()</script><br><a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><img src=https://cdn.jsdelivr.net/gh/acai66/live2d@0.52/pics/upyun.svg></a></section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.16.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></script></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>